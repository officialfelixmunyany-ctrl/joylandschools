/**
 * main.js - consolidated JavaScript
 * Auto-generated by refactor script: concatenates multiple smaller files for fewer requests.
 */

// ===== animations.js =====
/*
 * Particles Animation System
 * Math-based particle effects for hero sections
 */

class ParticleSystem {
  constructor(containerId, particleCount = 50) {
    this.container = document.getElementById(containerId);
    if (!this.container) return;
    
    this.particleCount = particleCount;
    this.particles = [];
    this.init();
  }

  init() {
    const particlesDiv = document.createElement('div');
    particlesDiv.className = 'particles';
    this.container.appendChild(particlesDiv);

    for (let i = 0; i < this.particleCount; i++) {
      this.createParticle(particlesDiv);
    }
  }

  createParticle(container) {
    const particle = document.createElement('div');
    particle.className = 'particle';
    const x = Math.random() * 100;
    const y = Math.random() * 100;
    const size = Math.random() * 4 + 2;
    const duration = Math.random() * 4 + 3;

    particle.style.left = x + '%';
    particle.style.top = y + '%';
    particle.style.width = size + 'px';
    particle.style.height = size + 'px';
    particle.style.setProperty('--particle-duration', duration + 's');

    container.appendChild(particle);
  }
}

class AnimatedCounter {
  constructor(element, target, duration = 2000) {
    this.element = element;
    this.target = target;
    this.duration = duration;
    this.current = 0;
    this.animate();
  }

  animate() {
    const start = Date.now();
    const animate = () => {
      const progress = Math.min((Date.now() - start) / this.duration, 1);
      const eased = 1 - Math.pow(1 - progress, 3);
      this.current = Math.floor(eased * this.target);
      this.element.textContent = this.current.toLocaleString();
      if (progress < 1) {
        requestAnimationFrame(animate);
      }
    };
    requestAnimationFrame(animate);
  }
}

class FormAnimation {
  constructor(formSelector) {
    this.form = document.querySelector(formSelector);
    if (!this.form) return;

    this.inputs = this.form.querySelectorAll('input, textarea, select');
    this.init();
  }

  init() {
    this.inputs.forEach(input => {
      input.addEventListener('focus', () => {
        input.parentElement.style.boxShadow = '0 0 0 3px rgba(102, 126, 234, 0.1)';
      });

      input.addEventListener('blur', () => {
        input.parentElement.style.boxShadow = 'none';
      });

      input.addEventListener('change', () => {
        if (input.checkValidity && !input.checkValidity()) {
          input.style.borderColor = 'var(--danger)';
        } else if (input.value) {
          input.style.borderColor = 'var(--success)';
        }
      });
    });
  }
}

function smoothScroll() {
  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
      e.preventDefault();
      const target = document.querySelector(this.getAttribute('href'));
      if (target) {
        target.scrollIntoView({ behavior: 'smooth' });
      }
    });
  });
}

function observeElements() {
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add('animate-fade');
        observer.unobserve(entry.target);
      }
    });
  }, { threshold: 0.1 });

  document.querySelectorAll('.card, .stat-card, .alert').forEach(el => {
    observer.observe(el);
  });
}

function navbarScrollEffect() {
  const navbar = document.querySelector('.navbar');
  if (!navbar) return;

  window.addEventListener('scroll', () => {
    if (window.scrollY > 10) {
      navbar.style.boxShadow = 'var(--shadow-lg)';
    } else {
      navbar.style.boxShadow = 'var(--shadow-md)';
    }
  });
}

document.addEventListener('DOMContentLoaded', () => {
  new ParticleSystem('hero-particles');
  new FormAnimation('form');
  smoothScroll();
  observeElements();
  navbarScrollEffect();
  document.querySelectorAll('[data-count]').forEach(el => {
    const target = parseInt(el.getAttribute('data-count'));
    new AnimatedCounter(el, target);
  });
});

// ===== hero-status.js (no-op placeholder) =====
/* hero-status.js - removed during cleanup. No runtime behavior. */

// ===== hero-transition.js (no-op placeholder) =====
/* hero-transition.js - removed during cleanup. No-op placeholder. */

// ===== landing-carousel.js (no-op placeholder) =====
document.addEventListener('DOMContentLoaded', function () {
  /* landing-carousel.js removed on cleanup. No-op placeholder kept for compatibility. */
});

// ===== navbar-hover.js =====
(function(){
  function isTouch() { return ('ontouchstart' in window) || navigator.maxTouchPoints > 0; }
  if (isTouch()) return;

  document.querySelectorAll('.navbar .dropdown').forEach(function(drop){
    drop.addEventListener('mouseenter', function(){
      drop.classList.add('show');
      var menu = drop.querySelector('.dropdown-menu');
      if(menu) { menu.classList.add('show'); }
    });
    drop.addEventListener('mouseleave', function(){
      drop.classList.remove('show');
      var menu = drop.querySelector('.dropdown-menu');
      if(menu) { menu.classList.remove('show'); }
    });
    drop.addEventListener('focusin', function(){ drop.classList.add('show'); var m=drop.querySelector('.dropdown-menu'); if(m) m.classList.add('show'); });
    drop.addEventListener('focusout', function(){ drop.classList.remove('show'); var m=drop.querySelector('.dropdown-menu'); if(m) m.classList.remove('show'); });
  });
})();

// ===== navbar-mobile-accordion behavior =====
(function(){
  function isMobile() { return window.matchMedia('(max-width: 767.98px)').matches; }

  function closeAllDropdowns(container) {
    var open = (container || document).querySelectorAll('.navbar .dropdown.show');
    open.forEach(function(d){
      d.classList.remove('show');
      var m = d.querySelector('.dropdown-menu'); if (m) m.classList.remove('show');
      var t = d.querySelector('.dropdown-toggle'); if (t) t.setAttribute('aria-expanded','false');
    });
  }

  document.addEventListener('DOMContentLoaded', function(){
    // Only enable accordion behavior on narrow viewports
    function setup() {
      if (!isMobile()) return;

      // Toggle top-level dropdowns as accordion panels
      document.querySelectorAll('.navbar .dropdown-toggle').forEach(function(btn){
        // remove duplicate handlers if reinitialized
        btn.__mobileAccordionBound = btn.__mobileAccordionBound || false;
        if (btn.__mobileAccordionBound) return;
        btn.__mobileAccordionBound = true;

        btn.addEventListener('click', function(e){
          if (!isMobile()) return; // let bootstrap handle desktop
          e.preventDefault(); e.stopPropagation();
          var parent = btn.closest('.dropdown');
          if (!parent) return;
          var menu = parent.querySelector('.dropdown-menu');
          var open = parent.classList.contains('show');

          // close siblings
          var nav = parent.closest('.navbar-nav') || document;
          nav.querySelectorAll('.dropdown.show').forEach(function(d){ if (d !== parent) { d.classList.remove('show'); var mm = d.querySelector('.dropdown-menu'); if(mm) mm.classList.remove('show'); var tt = d.querySelector('.dropdown-toggle'); if(tt) tt.setAttribute('aria-expanded','false'); }});

          if (open) {
            parent.classList.remove('show'); if (menu) menu.classList.remove('show'); btn.setAttribute('aria-expanded','false');
          } else {
            parent.classList.add('show'); if (menu) menu.classList.add('show'); btn.setAttribute('aria-expanded','true');
          }
        });
      });

      // Handle dropdown items that themselves contain submenus (nested menus)
      document.querySelectorAll('.navbar .dropdown-item').forEach(function(item){
        // if this item has a nested .dropdown-menu inside its parent li, toggle it
        var parentLi = item.closest('li');
        if (!parentLi) return;
        var nested = parentLi.querySelector('.dropdown-menu');
        if (!nested) return;

        item.__mobileSubBound = item.__mobileSubBound || false;
        if (item.__mobileSubBound) return;
        item.__mobileSubBound = true;

        item.addEventListener('click', function(e){
          if (!isMobile()) return;
          // If the item links to an actual page, keep default behavior when tapping the caret specifically.
          e.preventDefault(); e.stopPropagation();
          var open = nested.classList.contains('show');
          nested.classList.toggle('show', !open);
        });
      });

      // Click outside to close
      document.addEventListener('click', function(e){ if (!isMobile()) return; if (!e.target.closest('.navbar')) { closeAllDropdowns(); }} , { passive: true });
    }

    // Run setup now and when the viewport changes
    setup();
    window.matchMedia('(max-width: 767.98px)').addEventListener('change', function(){ if (this.matches) setup(); else closeAllDropdowns(); });
  });
})();
