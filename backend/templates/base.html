<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}Joyland Schools{% endblock %}</title>
  {% load static %}
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <!-- Modern portal theme -->
  <link rel="stylesheet" href="{% static 'css/theme.css' %}">
  <!-- Organic background effects -->
  <link rel="stylesheet" href="{% static 'css/organic-background.css' %}">
  <!-- design tokens & custom styles -->
  <link rel="stylesheet" href="{% static 'css/design-tokens.css' %}">
  <!-- custom.css version: v3 -->
  <link rel="stylesheet" href="{% static 'css/custom.css' %}?v=3">
  {# Preload links removed: hero background images are not used by default to avoid layout jank. #}
    {% block extra_head %}
    <style>
      /* Ensure page background is transparent so the full-viewport image shows */
      html, body { background: transparent; height: 100%; }

      /* Use template static URLs to avoid filename encoding problems */
      html::before {
        content: '';
        position: fixed;
        inset: 0;
        z-index: -1;
        background-image: none;
        background-size: cover;
        background-position: center center;
        background-repeat: no-repeat;
        will-change: transform;
        transform: translateZ(0);
        /* Subtle blur on the background image itself */
        filter: blur(2px);
        -webkit-filter: blur(2px);
      }

      /* Background image removed intentionally to avoid layout issues */
      @media (min-width: 1200px) {
        html::before { background-image: none !important; }
      }
      @media (min-width: 768px) and (max-width: 1199px) {
        html::before { background-image: none !important; }
      }

      /* Keep site-panel above the background */
      .site-panel { position: relative; z-index: 2; }
    </style>
    {% endblock %}
  </head>
  <body>
    <a class="visually-hidden-focusable skip-to-content" href="#main-content">Skip to content</a>
    
    <!-- Organic animated background with depth illusions -->
    <div id="background-container"></div>
    
    <!-- Light rays and visual effects -->
    <div class="light-rays">
      <div class="light-ray"></div>
      <div class="light-ray"></div>
      <div class="light-ray"></div>
    </div>
    
    <!-- Bokeh lights for depth -->
    <div class="bokeh-lights">
      <div class="bokeh"></div>
      <div class="bokeh"></div>
      <div class="bokeh"></div>
    </div>
    
    <!-- Depth field layers -->
    <div class="depth-field">
      <div class="depth-layer"></div>
      <div class="depth-layer"></div>
      <div class="depth-layer"></div>
    </div>
    
    <!-- Moire pattern overlay (optical illusion) -->
    <div class="moire-overlay">
      <div class="moire-pattern"></div>
    </div>
    
    <!-- Shimmer overlay -->
    <div class="shimmer-overlay"></div>
    
    <!-- Vignette edge darkening -->
    <div class="vignette"></div>
    
    {# Extracted navbar to includes/navbar.html for consistent layout and easier refactor #}
    {% include 'includes/navbar.html' %}

    <!-- Hero background is shown directly; curtain/enter overlay removed for a cleaner UX -->
    <div aria-hidden="true" class="sr-only" style="position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden;">
      Curtain overlay removed â€” background displayed directly.
    </div>
    <div id="main-content" class="container-fluid px-0 mt-0">
      {% block content %}{% endblock %}
    </div>


  <!-- HTMX + Alpine for lightweight interactivity (progressive enhancement) -->
  <script src="https://unpkg.com/htmx.org@1.10.0"></script>
  <script defer src="https://unpkg.com/alpinejs@3.12.0/dist/cdn.min.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  {% block extra_js %}{% endblock %}
  <script src="{% static 'js/main.js' %}"></script>
  <!-- Curtain JS removed. Background image is shown by CSS defined in the head. -->
  <!-- Global modal used by HTMX-driven forms -->
  <div class="modal fade" id="globalModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content" id="globalModalContent"></div>
    </div>
  </div>

  <script>
    // When HTMX loads content that dispatches 'htmx:modal-ready', show bootstrap modal
    document.addEventListener('htmx:modal-ready', (e) => {
      var modalEl = document.getElementById('globalModal');
      if (!modalEl) return;
      var modal = new bootstrap.Modal(modalEl);
      modal.show();
      // After showing, focus first input inside modal for accessibility
      modalEl.addEventListener('shown.bs.modal', function () {
        var first = modalEl.querySelector('#globalModalContent input, #globalModalContent textarea, #globalModalContent select');
        if (first) first.focus();
      }, { once: true });
    });
  </script>
  <script>
    // When an announcement is saved or deleted on the server, HTMX will
    // surface a HX-Trigger header which becomes an event we can listen to.
    document.body.addEventListener('announcementSaved', function (e) {
      // hide modal if open
      var modalEl = document.getElementById('globalModal');
      if (modalEl) {
        var mod = bootstrap.Modal.getInstance(modalEl);
        if (mod) mod.hide();
      }
      // refresh announcements panel
      var panel = document.getElementById('announcements-panel');
      if (panel) {
        htmx.ajax('GET', panel.getAttribute('hx-get'), {target: panel});
      }
    });

    document.body.addEventListener('announcementDeleted', function (e) {
      var modalEl = document.getElementById('globalModal');
      if (modalEl) {
        var mod = bootstrap.Modal.getInstance(modalEl);
        if (mod) mod.hide();
      }
      var panel = document.getElementById('announcements-panel');
      if (panel) {
        htmx.ajax('GET', panel.getAttribute('hx-get'), {target: panel});
      }
    });
  </script>

  <!-- Consolidated scripts -->
  <!-- main.js includes animations and navbar behavior. organic-background.js removed (CSS-only). -->

  </body>
</html>
